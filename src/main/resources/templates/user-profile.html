<!DOCTYPE html>
<html lang="fi">
    <head>
        <div th:replace="fragments/app :: head(title='Facetale')"></div>
        <link rel="stylesheet" type="text/css" th:href="@{/static/css/user-profile.css}">
        <script th:inline="javascript">
            var contextRoot = /*[[@{/}]]*/ "";
            var _csrf_token = /*[[${_csrf.token}]]*/ '';
            var _csrf_param_name = /*[[${_csrf.parameterName}]]*/ '';
            var auserId = /*[[${auser.id}]]*/ "";
            var profileUsername = /*[[${profileModel.user.username}]]*/ "";
            var profileName = /*[[${profileModel.user.name}]]*/ "";
            var profileTag = /*[[${profileModel.user.profileTag}]]*/ "";
            var profileViewDisplayType = /*[[${profileModel.displayType.name()}]]*/ "";
        </script>
        <script type="text/javascript" th:src="@{/static/js/form-utilities.js}" defer></script>
        <script type="text/javascript" th:src="@{/static/js/user-profile.js}" defer></script>
    </head>
    <body>
        <div th:replace="fragments/app :: master-head"></div>
        <main>
            <div id="main-container">
                <div class="column secondary">
                    <div id="user-profile-container">
                        <div id="user-profile-wrapper">
                            <img th:src="@{${profileModel.auserRelationship == T(wepa.ftale.web.profile.UserRelationship).ITSELF} ? ${@imageService.getAuthenticatedUserProfilePictureLocation()} :
                            ${@imageService.getUserProfilePictureLocation(profileModel.user)}}" alt="Profile picture" />
                            <form
                                th:if="${profileModel.auserRelationship == T(wepa.ftale.web.profile.UserRelationship).ITSELF} and ${profileModel.user.profilePicture != null}"
                                th:action="@{/api/user/resetprofilepic}" th:method="POST" class="profile-picture-action">
                                <input type="hidden" name="accountId" th:value="${profileModel.user.id}" />
                                <button type="submit" class="ft-button nav-link">Poista profiilikuva</button>
                            </form>
                            <h1 th:text="${profileModel.user.name}">name</h1>
                            <h2 th:text="${profileModel.user.profileTag}">profileTag</h2>
                            <th:block th:switch="${profileModel.auserRelationship}">
                                <p th:case="${T(wepa.ftale.web.profile.UserRelationship).ITSELF}"><i class="fas fa-user fa-sm"></i>Oma profiili</p>
                                <p th:case="${T(wepa.ftale.web.profile.UserRelationship).FRIEND}"><i class="fas fa-user-friends fa-sm"></i>Kaveri</p>
                                <p th:case="${T(wepa.ftale.web.profile.UserRelationship).FRIEND_REQ_SENT}">
                                    <i class="fas fa-user-plus fa-sm"></i>Kaveripyyntö lähetetty</p>
                                <p th:case="${T(wepa.ftale.web.profile.UserRelationship).FRIEND_REQ_RECEIVED}">
                                    <i class="fas fa-user-clock fa-sm"></i>Odottava kaveripyyntö</p>
                            </th:block>
                            <ul id="user-profile-toolbar">
                                <div class="flex-space-between-wrapper">
                                    <li>
                                        <button type="button" class="ft-button nav-link" onclick="changeProfileViewDisplayType();"
                                            id="change-profileview-displaytype">displayType</button>
                                    </li>
                                    <li>
                                        <th:block th:switch="${profileModel.auserRelationship == T(wepa.ftale.web.profile.UserRelationship).ITSELF} ? ${true} :
                                        ${profileModel.auserRelationship == T(wepa.ftale.web.profile.UserRelationship).FRIEND}">
                                            <a th:case="${true}" th:href="@{/users/{profileTag}/friends(profileTag=${profileModel.user.profileTag})}"
                                                class="nav-link"><i class="fas fa-user-friends"></i>Kaverit</a>
                                            <div th:case="${false}" class="pos-relative-wrapper">
                                                <a href="javascript:void(0);" class="nav-link user-action-disabled">
                                                    <i class="fas fa-user-friends"></i>Kaverit</a>
                                                <p class="user-action-tooltip">Nähdäksesi toisten kaverit sinun täytyy olla kavereita heidän kanssa.
                                                </p>
                                            </div>
                                        </th:block>
                                    </li>
                                </div>
                                <li th:if="${profileModel.auserRelationship == T(wepa.ftale.web.profile.UserRelationship).STRANGER}">
                                    <form th:action="@{/api/user/sendfriendreq}" th:method="POST">
                                        <input type="hidden" name="senderId" th:value="${auser.id}" />
                                        <input type="hidden" name="recipientId" th:value="${profileModel.user.id}" />
                                        <button type="submit" class="ft-button nav-link">
                                            <i class="fas fa-user-plus"></i>Lähetä kaveripyyntö</button>
                                    </form>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="column primary">
                    <div id="posts-container">
                        <div id="posts-header">
                            <h1 id="profileview-displaytype-title">displayType</h1>
                        </div>
                        <!-- TODO 
                            Profile status (own profile / friend etc)
                            DISABLED (textfields & buttons) + TOOLTIPS / reason
                            New comment
                            Load replies
                            Load posts/album
                            Album/posts change button
                            Change title (posts-header) + page title Facetale | username - Posts | Album
                            cancel comment
                            FORM ERROR!
                            No posts notification
                            (${post} ? 'new-post-' : 'new-comment-') +
                            <img th:src="@{${@imageService.getUserProfilePictureLocation(auser.account)}}" class="profile-picture-small" alt="Profile picture" /-->
                        <div th:replace="fragments/post :: new-comment(auserRelationship=${profileModel.auserRelationship},
                        target = ${profileModel.user.id}, post=true)">
                        </div>
                        <div th:replace="fragments/post :: new-image-post(imageCount = 9, target = ${auser.id})"> </div>
                        <div id="total-post-count-notification">
                            <p id="total-post-count" th:with="totalpostcount=${profileModel.posts.getTotalElements()}" th:data-totalcount="${profileModel.posts.getTotalElements()}"
                            th:text="${totalpostcount} > 0 ? ${totalpostcount} + ' Julkaisua' : 'Yhtään julkaisuja ei löytynyt.'">
                                
                               </p>
                            <!--     //  [[${profileModel.posts.getTotalElements()}]] Julkaisua</p>
                            <p th:styleappend="${profileModel.posts.getTotalElements()} != 0 ? 'display:none;'" class="fe-error-message">Yhtään
                                julkaisuja ei löytynyt.</p> -->
                        </div>
                        <div
                            th:replace="fragments/post :: main-post-list(auserRelationship=${profileModel.auserRelationship}, comments=${profileModel.posts}, viewMap=${profileModel.userPostViews})">
                        </div>
                        <!--ul class="posts-list">
                            <!-- PRIMARY --
                            <li class="commentbox">
                                <img th:src="@{/static/images/Portrait_placeholder.png}" class="profile-picture-small" alt="Profile picture" />
                                <div class="comment">
                                    <a href="#" class="comment-author-info">Test <span>@test</span></a>
                                    <p class="comment-text-content">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam diam enim, luctus
                                        at tempor nec, laoreet a augue. Cras ac ligula sem. Donec facilisis justo sagittis nisl mollis aliquet.
                                        Integer vel elit quis lorem consequat ultricies. Integer lacus felis, porta ac nunc id, suscipit congue purus.
                                        Suspendisse potenti.</p>
                                    <div class="comment-info-wrapper">
                                        <div class="flex-space-between-wrapper">
                                            <h3>6 Tykkäystä</h3>
                                            <h3>30.4.2019 15:00</h3>
                                        </div>
                                        <div class="comment-actions">
                                            <button type="button" class="ft-button">Tykkää</button>
                                            <button type="button" class="ft-button">Kommentoi</button>
                                            <button type="button" class="ft-button expand-comment-section-button">6 Kommenttia <i
                                                    class="fas fa-chevron-down"></i></button>
                                        </div>
                                    </div>
                                    <!-- REPLIES --
                                    <div class="comment-replies">
                                        <div th:replace="fragments/post :: new-comment(auserRelationship=${profileModel.auserRelationship}, target = 'COMMENT_ID_PLACEHOLDER', post=false)"></div>
                                        <ul class="posts-list">
                                            <li class="commentbox">
                                                <img th:src="@{/static/images/Portrait_placeholder.png}" class="profile-picture-small"
                                                    alt="Profile picture" />
                                                <div class="comment">
                                                    <a href="#" class="comment-author-info">Test <span>@test</span></a>
                                                    <p class="comment-text-content">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam
                                                        diam enim, luctus at tempor nec, laoreet a augue. Cras ac ligula sem. Donec facilisis justo
                                                        sagittis nisl mollis aliquet. Integer vel elit quis lorem consequat ultricies. Integer lacus
                                                        felis, porta ac nunc id, suscipit congue purus. Suspendisse potenti.</p>
                                                </div>
                                            </li>
                                            <li class="commentbox">
                                                <img th:src="@{/static/images/Portrait_placeholder.png}" class="profile-picture-small"
                                                    alt="Profile picture" />
                                                <div class="comment">
                                                    <a href="#" class="comment-author-info">Test <span>@test</span></a>
                                                    <p class="comment-text-content">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam
                                                        diam enim, luctus at tempor nec, laoreet a augue. Cras ac ligula sem. Donec facilisis justo
                                                        sagittis nisl mollis aliquet. Integer vel elit quis lorem consequat ultricies. Integer lacus
                                                        felis, porta ac nunc id, suscipit congue purus. Suspendisse potenti.</p>
                                                </div>
                                            </li>
                                            <li class="commentbox">
                                                <img th:src="@{/static/images/Portrait_placeholder.png}" class="profile-picture-small"
                                                    alt="Profile picture" />
                                                <div class="comment">
                                                    <a href="#" class="comment-author-info">Test <span>@test</span></a>
                                                    <p class="comment-text-content">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam
                                                        diam enim, luctus at tempor nec, laoreet a augue. Cras ac ligula sem. Donec facilisis justo
                                                        sagittis nisl mollis aliquet. Integer vel elit quis lorem consequat ultricies. Integer lacus
                                                        felis, porta ac nunc id, suscipit congue purus. Suspendisse potenti.</p>
                                                </div>
                                            </li>
                                        </ul>
                                        <!-- LOAD MORE--
                                        <div class="load-items-container">
                                            <div class="lds-ring">
                                                <div></div>
                                                <div></div>
                                                <div></div>
                                                <div></div>
                                            </div>
                                            <p class="fe-error-message">Virhe ladattaessa kommentteja!</p>
                                            <button type="button" id="load-more-comments" class="ft-button" onclick="document.getElementsByClassName('lds-ring')[0].style.display='block';
                                            document.getElementById('load-more-comments').style.display='none';">Lataa lisää kommentteja</button>
                                        </div>
                                        <!-- LOAD MORE--
                                    </div>
                                    <!-- REPLIES END  --
                                </div>
                            </li>
                        </ul>
                        <!-- LOAD MORE-->
                        <div class="load-items-container" id ="main-post-list-loader" th:data-postlisttarget="${auser.id}">
                            <!-- id = "main-post-list-loader">-->
                            <div class="lds-ring">
                                <div></div>
                                <div></div>
                                <div></div>
                                <div></div>
                            </div>
                            <!--p class="fe-error-message">Virhe ladattaessa kommentteja!document.getElementsByClassName('lds-ring')[1].style.display='block';
                            document.getElementById('load-more-comments2').style.display='none';"</p-->
                            <button type="button" class="ft-button" onclick="loadComments('main-post-list-loader');">Lataa lisää kommentteja</button>
                        </div>
                        <!-- LOAD MORE-->
                    </div>
                </div>
            </div>
        </main>
        <footer th:replace="fragments/app :: master-footer"></footer>
    </body>
</html>